#                    麦点甄选运营平台项目

麦点甄选运营平台项目,包含运营平台项目模板从0到1开发，以及数据大屏幕、权限等业务。

涉及技术栈包含***:vue3+TypeScript+vue-router+pinia+element-plus+axios+echarts***等技术栈。

## 第一个重点:批量注册全局组件

```ts
import SvgIcon from './SvgIcon/index.vue'
import Pagination from './Pagination/index.vue'
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
// 全局对象
const allGlobalComponent = { SvgIcon, Pagination }

// 对外暴露插件对象
export default {
  //务必叫做install方法
  install(app) {
    Object.keys(allGlobalComponent).forEach((key) => {
      app.component(key, allGlobalComponent[key])
    })
    // 注册全部el-icon图标
    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
      app.component(key, component)
    }
  }
}
```

在入口文件中引入并注册

```ts
// 引入自定义插件对象：注册整个项目全局组件
import gloalComponents from "@/components";
// 注册自定义插件
app.use(gloalComponents);
```

## 第一个重点：路由鉴权

**路由鉴权**：鉴权，项目中路由能不能被访问的权限设置(某一个路由什么条件下可以访问，什么条件不能访问)

**需求**:注意用户是否登录，如果没登录不能去除了login页面以外的页面，并且带上之前想要去的页面路径，如果登录了就不能去login页面，如果去login页面就重定向到主页面，还需要注意用户登录之后需要发请求获取用户信息，如果拿不到用户信息说明token过期了，token过期了就需要清除用户以前的信息并跳转到登录页让用户重新登录

```ts
import router from '@/router'
router.beforeEach(async (to: any, from: any, next: any) => {
  nprogress.start()
  // 改变导航栏标题
  document.title=`${TITLE}`+`-${to.meta.title}`
  let token = LocalCache.getCache(LOGIN_TOKEN)
  let userState = useUserState()
  // 拿到用户信息
  let username = userState.username
  // 判断用户是否登录
  if (token) {
    // 用户登录了
    if (to.path == '/login') {
      // 登录了不能去登录页
      next('/home')
    } else {
      // 登录成功访问其他路由都可以
      // 是否存在用户信息
      if (!username) {
        try {
          // 发请求获取用户信息
          await userState.getUserInfo()
          next()
        } catch (error) {
          // 获取用户信息失败(也就是token过期)
          // 先退出登录
          await userState.userLogOut()
          next({path:'/login',query:{redirect:to.path}})
        }
      } else {
        // 存在则直接放行
        next()
      }
    }
  } else {
    // 用户未登录
    // 如果不是去登录页
    if (to.path != '/login') {
      // 将想要去的页面等到登录后重定向去
      next({ path: '/login', query: { redirect: to.path } })
    } else {
      next()
    }
  }
})
// 全局后置路由守卫
router.afterEach((to: any, from: any) => {
  nprogress.done()
})
```

> 需要注意很多细节问题，考虑要全面

## 一个难点：对element-plus中的el-pagination分页器组件进行二次封装

原因:在项目中，如果每个列表页面都要写一遍分页方法，就会造成大量的代码冗余。所以需要进行二次封装来简化代码

**封装分页器的子组件**

```vue
<template>
  <div class="pagenation">
    <el-config-provider :locale="locale">
      <el-pagination
        v-model:current-page="paginationData.pageNo"
        v-model:page-size="paginationData.pageSize"
        :page-sizes="[3, 5, 10]"
        background
        layout=" prev, pager, next, jumper,->,sizes,total"
        :total="paginationData.total"
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
      />
    </el-config-provider>
  </div>
</template>

<script setup lang="ts">
import { computed, ref } from 'vue'
import zhCn from 'element-plus/dist/locale/zh-cn.mjs'
import en from 'element-plus/dist/locale/en.mjs'
import { reactive } from 'vue';
// 使用中文语言
const language = ref('zh-cn')
const locale = computed(() => (language.value === 'zh-cn' ? zhCn : en))
// 接收父组件传过来的当前页数与每页数据条数以及总数据条数
const props = defineProps<{
  //总数据条数
  total:number,
  // 当前页数
  pageNo:number,
  // 每页数据条数
  pageSize:number
}>()
let paginationData=reactive({
  // 需要通过触发自定义事件带给父组件发送请求获取新页码对应的数据
  pageNo:props.pageNo,
  pageSize:props.pageSize,
  // 这里只父组件通过props传递一次total就行了，不需要通过触发自定义事件带给父组件
  // total:props.total
})
// 生成事件对象
const $emit = defineEmits(['change','update:pageSize','update:pageNo'])
// 改变每页数据条数
const handleSizeChange = (val: number) => {
  // 使用自定义事件实现父子组件数据同步
  $emit('update:pageSize',val)
  // 触发自定义事件获取对应当页指定条数的数据
  $emit('change',paginationData)
}
// 改变当前页数
const handleCurrentChange = (val: number) => {
  // 使用自定义事件实现父子组件数据同步
  $emit('update:pageNo',val)
  // 自定义事件获取对应页码的数据
  $emit('change',paginationData)
}
</script>

<style lang="scss" scoped></style>

```

父组件中使用

```vue
<template>
  <div class="trademark">
     <!-- 分页器 -->
     <Pagination 
       :total="20" 
       v-model:pageNo="pageNo" 
       v-model:pageSize="pageSize" 
       @change="handlerChangePage"
     ></Pagination>
  </div>
</template>

<script setup lang="ts">
import Pagination from '@/components/Pagination/index.vue'
import { reqProTrademarkList } from '@/api/product/index'
import { ref } from 'vue';
let pageNo = ref(1)
let pageSize = ref(3)
// 改变当前页数
const handlerChangePage=({pageNo,pageSize})=>{
  console.log(pageNo,pageSize);
  // 拿到子组件改变的page与pagesize后可以发送请求获取新页码对应数据
}
</script>

<style lang="scss" scoped></style>
```

